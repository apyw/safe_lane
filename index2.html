<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="theme.css" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>My Google Map</title>
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>

  <body>
    <input id="pac-input" class="controls" type="text" placeholder="Search" />
    <input id="pointA-input" class="controls" type="text" placeholder="From" />
    <input id="pointB-input" class="controls" type="text" placeholder="To" />

    <div id="map"></div>

    <script>
      function initMap() {
        // Map options
        var options = {
          zoom: 13,
          center: { lat: 43.7, lng: -79.3 },
          // style designed through
          styles: [
            {
              elementType: "geometry",
              stylers: [
                {
                  color: "#242f3e"
                }
              ]
            },
            {
              elementType: "labels.text.fill",
              stylers: [
                {
                  color: "#746855"
                }
              ]
            },
            {
              elementType: "labels.text.stroke",
              stylers: [
                {
                  color: "#242f3e"
                }
              ]
            },
            {
              featureType: "administrative.locality",
              elementType: "labels.text.fill",
              stylers: [
                {
                  color: "#d59563"
                }
              ]
            },
            {
              featureType: "poi",
              elementType: "labels.text.fill",
              stylers: [
                {
                  color: "#d59563"
                }
              ]
            },
            {
              featureType: "poi.business",
              stylers: [
                {
                  visibility: "off"
                }
              ]
            },
            {
              featureType: "poi.park",
              elementType: "geometry",
              stylers: [
                {
                  color: "#263c3f"
                }
              ]
            },
            {
              featureType: "poi.park",
              elementType: "labels.text.fill",
              stylers: [
                {
                  color: "#6b9a76"
                }
              ]
            },
            {
              featureType: "poi.school",
              stylers: [
                {
                  visibility: "off"
                }
              ]
            },
            {
              featureType: "road",
              stylers: [
                {
                  visibility: "on"
                }
              ]
            },
            {
              featureType: "road",
              elementType: "geometry",
              stylers: [
                {
                  color: "#38414e"
                }
              ]
            },
            {
              featureType: "road",
              elementType: "geometry.stroke",
              stylers: [
                {
                  color: "#212a37"
                }
              ]
            },
            {
              featureType: "road",
              elementType: "labels.text.fill",
              stylers: [
                {
                  color: "#9ca5b3"
                }
              ]
            },
            {
              featureType: "road.highway",
              elementType: "geometry",
              stylers: [
                {
                  color: "#746855"
                }
              ]
            },
            {
              featureType: "road.highway",
              elementType: "geometry.stroke",
              stylers: [
                {
                  color: "#1f2835"
                }
              ]
            },
            {
              featureType: "road.highway",
              elementType: "labels.text.fill",
              stylers: [
                {
                  color: "#f3d19c"
                }
              ]
            },
            {
              featureType: "transit",
              elementType: "geometry",
              stylers: [
                {
                  color: "#2f3948"
                }
              ]
            },
            {
              featureType: "transit.station",
              elementType: "labels.text.fill",
              stylers: [
                {
                  color: "#d59563"
                }
              ]
            },
            {
              featureType: "water",
              elementType: "geometry",
              stylers: [
                {
                  color: "#17263c"
                }
              ]
            },
            {
              featureType: "water",
              elementType: "labels.text.fill",
              stylers: [
                {
                  color: "#515c6d"
                }
              ]
            },
            {
              featureType: "water",
              elementType: "labels.text.stroke",
              stylers: [
                {
                  color: "#17263c"
                }
              ]
            }
          ]
        };

        // New map
        var map = new google.maps.Map(document.getElementById("map"), options);

        // Array of markers
        var markers = [
          {
            coords: { lat: 43.71677, lng: -79.2599 },
            iconImage: "images/marker_red.png",
            content: "<h3>St.Claire, Danforth</h3>"
          },
          {
            coords: { lat: 43.63774, lng: -79.4589 },
            iconImage: "images/marker_yellow.png",
            content: "<h3>Lake Shore Bv W, Colborne Lodge Dr</h3>"
          }
        ];

        // Loop through markers
        for (var i = 0; i < markers.length; i++) {
          // Add marker
          addMarker(markers[i]);
        }

        // Add Marker Function
        function addMarker(props) {
          var marker = new google.maps.Marker({
            position: props.coords,
            map: map
            //icon:props.iconImage
          });

          // Check for customicon
          if (props.iconImage) {
            // Set icon image
            marker.setIcon(props.iconImage);
          }

          // Check content
          if (props.content) {
            var infoWindow = new google.maps.InfoWindow({
              content: props.content
            });

            marker.addListener("click", function() {
              infoWindow.open(map, marker);
            });
          }
        }

        // search
        var input = document.getElementById("pac-input");
        var searchBox = new google.maps.places.SearchBox(input);
        map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

        var autocomplete = new google.maps.places.Autocomplete(input);
        autocomplete.bindTo("bounds", map);

        var infowindow = new google.maps.InfoWindow();
        var marker = new google.maps.Marker({
          map: map,
          anchorPoint: new google.maps.Point(0, -29)
        });

        autocomplete.addListener("place_changed", function() {
          infowindow.close();
          marker.setVisible(false);
          var place = autocomplete.getPlace();
          if (!place.geometry) {
            window.alert("Autocomplete's returned place contains no geometry");
            return;
          }

          // If the place has a geometry, then present it on a map.
          if (place.geometry.viewport) {
            map.fitBounds(place.geometry.viewport);
          } else {
            map.setCenter(place.geometry.location);
            map.setZoom(17);
          }
          marker.setIcon({
            url: place.icon,
            size: new google.maps.Size(71, 71),
            origin: new google.maps.Point(0, 0),
            anchor: new google.maps.Point(17, 34),
            scaledSize: new google.maps.Size(35, 35)
          });
          marker.setPosition(place.geometry.location);
          marker.setVisible(true);

          var address = "";
          if (place.address_components) {
            address = [
              (place.address_components[0] &&
                place.address_components[0].short_name) ||
                "",
              (place.address_components[1] &&
                place.address_components[1].short_name) ||
                "",
              (place.address_components[2] &&
                place.address_components[2].short_name) ||
                ""
            ].join(" ");
          }
        });

        //button
        function CenterControl(controlDiv, map) {
          // CSS for the control border
          var controlUI = document.createElement("div");
          controlUI.style.backgroundColor = "#fff";
          controlUI.style.border = "2px solid #fff";
          controlUI.style.borderRadius = "3px";
          controlUI.style.boxShadow = "0 2px 6px rgba(0,0,0,.3)";
          controlUI.style.cursor = "pointer";
          controlUI.style.marginTop = "10px";
          controlUI.style.marginLeft = "100px";
          controlUI.style.textAlign = "center";
          controlUI.title = "Click to recenter the map";
          controlDiv.appendChild(controlUI);

          // CSS for the control interior
          var controlText = document.createElement("div");
          controlText.style.color = "rgb(25,25,25)";
          controlText.style.fontFamily = "Roboto,Arial,sans-serif";
          controlText.style.fontSize = "16px";
          controlText.style.lineHeight = "38px";
          controlText.style.paddingLeft = "5px";
          controlText.style.paddingRight = "5px";
          controlText.innerHTML = "Get route";
          controlUI.appendChild(controlText);

          // Setup click event
          controlUI.addEventListener("click", function() {
            calculate_route();
          });
        }

        // Create the DIV to hold the control and call the CenterControl()
        // constructor passing in this DIV
        var centerControlDiv = document.createElement("div");
        var centerControl = new CenterControl(centerControlDiv, map);

        centerControlDiv.index = 1;
        map.controls[google.maps.ControlPosition.TOP_CENTER].push(
          centerControlDiv
        );

        // set as pointA (from...)
        var pointA_input = document.getElementById("pointA-input");
        var From_Box = new google.maps.places.SearchBox(pointA_input);
        map.controls[google.maps.ControlPosition.LEFT_TOP].push(pointA_input);

        var autocomplete_A = new google.maps.places.Autocomplete(pointA_input);

        // set as pointB (to...)
        var pointB_input = document.getElementById("pointB-input");
        var To_Box = new google.maps.places.SearchBox(pointB_input);
        map.controls[google.maps.ControlPosition.LEFT_TOP].push(pointB_input);

        var autocomplete_B = new google.maps.places.Autocomplete(pointB_input);

        // geocode
        console.log("DB1")
        var geocoder = new google.maps.Geocoder();
        console.log("DB2")
        var address_A = autocomplete_A;
        console.log(autocomplete_A)
        console.log("DB3")
        var address_B = autocomplete_B;
        console.log(autocomplete_B)
        console.log("DB4")


        geocoder.geocode({ address: address_A }, function(results, status) {
            console.log("DB5")
          if (status == google.maps.GeocoderStatus.OK) {
            console.log("DB6")
            var latitude_A = results[0].geometry.location.latitude;
            var longitude_A = results[0].geometry.location.longitude;
            alert(latitude);
          }
        });
        console.log("DB7")
        geocoder.geocode({ address: address_B }, function(results, status) {
            console.log("DB8")
          if (status == google.maps.GeocoderStatus.OK) {
            console.log("DB9")
            var latitude_B = results[0].geometry.location.latitude;
            var longitude_B = results[0].geometry.location.longitude;
            alert(latitude);
          }
        });

        // Obtain routes
        console.log("DB10")
        var direction_display = new google.maps.DirectionsRenderer();
        console.log("DB11")
        var direction_service = new google.maps.DirectionsService();
        //console.log(latitude_A);
       // console.log(longitude_A)
        var pointA = new google.maps.LatLng(latitude_A, longitude_A);
        //var pointA = new google.maps.LatLng(40.658221, 81.658221)
        var pointB = new google.maps.LatLng(43.658221, -79.37099);

        direction_display.setMap(map);

        function calculate_route() {
          var request = {
            origin: pointA,
            destination: pointB,
            travelMode: "DRIVING"
          };

          direction_service.route(request, function(result, status) {
            if (status == "OK") {
              direction_display.setDirections(result);
            }
          });
        }

       
      }
    </script>
    <script
      async
      defer
      src="https://maps.googleapis.com/maps/api/js?libraries=places&key=AIzaSyBICA5nyVzj79DYqnRinnxvhADVzyKjX_g&callback=initMap"
    ></script>

  </body>
</html>
